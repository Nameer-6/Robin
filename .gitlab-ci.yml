stages:
  - test
  - report

run_login_feature:
  stage: test
  image: eclipse-temurin:20-jdk
  before_script:
    - apt-get update && apt-get install -y maven wget ca-certificates
    - update-ca-certificates
    - |
      # Check DNS resolution and retry logic for URL access
      nslookup dev-robin-uae.santechture.com || exit 1  # Check DNS resolution
      for i in {1..5}; do
        wget --spider --timeout=60 https://dev-robin-uae.santechture.com/ROBIN/ && break || sleep 10
      done
    - echo "ðŸ§ª Running login.feature test from resources/Features..."
    - mvn clean test "-DsuiteXmlFile=testng.xml" || true
    - ls -lah target/
  script:
    - echo "ðŸ§ª Running login.feature test from resources/Features..."
    - mvn clean test "-DsuiteXmlFile=testng.xml" || true
    - ls -lah target/
  artifacts:
    when: always
    paths:
      - target/cucumber.json
      - target/surefire-reports/
    expire_in: 1 week

generate_report:
  stage: report
  image: eclipse-temurin:20-jdk
  before_script:
    - apt-get update && apt-get install -y maven
  script:
    - echo "ðŸ“Š Generating enhanced HTML report..."
    - mvn exec:java "-Dexec.mainClass=utils.ReportGenerator" || true
  dependencies:
    - run_login_feature
  artifacts:
    when: always
    paths:
      - target/enhanced-report/
    expire_in: 1 week
