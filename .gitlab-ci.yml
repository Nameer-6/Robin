#stages:
#  - test
#
#run_login_feature:
#  stage: test
#  image: eclipse-temurin:20-jdk
#  before_script:
#    - apt-get update && apt-get install -y maven
#  script:
#    - echo "Running login.feature test..."
#    - mvn -version
#    - mvn clean test -Dcucumber.features=src/test/resources/features/login.feature
#  artifacts:
#    when: always  # ensure even on failure, artifacts get uploaded
#    paths:
#      - target/cucumber-reports/
#      - target/cucumber-reports/html/
#    reports:
#      junit: target/cucumber-reports/Cucumber.xml

stages:
  - test
  - report

run_login_feature:
  stage: test
  image: eclipse-temurin:20-jdk
  before_script:
    - apt-get update && apt-get install -y maven
  script:
    - echo "ğŸ” Running login.feature test..."
    - mvn -version
    - mvn clean test "-DsuiteXmlFile=testng.xml"
  artifacts:
    when: always
    paths:
      - target/cucumber-reports/
      - target/cucumber.json
      - target/enhanced-report/
    reports:
      junit: target/cucumber-reports/Cucumber.xml

generate_report:
  stage: report
  image: eclipse-temurin:20-jdk
  before_script:
    - apt-get update && apt-get install -y maven
  script:
    - echo "ğŸ“Š Generating enhanced Cucumber report..."
    - mvn exec:java "-Dexec.mainClass=utils.ReportGenerator"
  dependencies:
    - run_login_feature
  artifacts:
    when: always
    paths:
      - target/enhanced-report/
